{% extends "base.html" %}

{% block main_content %}
<section class="hero">
  <h2>‚öîÔ∏è Bienvenue dans l'ar√®ne des Morpions ‚öîÔ∏è</h2>
  <p>
    Composez vos √©quipes, exp√©rimentez des configurations de partie et surveillez leur performance.
    Cette page rassemble les statistiques principales n√©cessaires pour pr√©parer vos futures victoires.
  </p>
</section>

<section class="stats-cards">
  <h3>üìä Comptes instances (dev data)</h3>
  <div class="cards-grid">
    {% for compteur in REQUEST_VARS['stats']['counts'] %}
    <article class="card">
      <p class="card-label">{{ compteur.table|replace('_', ' ')|title }}</p>
      <p class="card-value">{{ compteur.count }}</p>
    </article>
    {% endfor %}
  </div>
</section>

<section class="top-teams">
  <h3>üèÜ Top {{ REQUEST_VARS['stats']['top_teams']|length }} √©quipes victorieuses</h3>
  {% if REQUEST_VARS['stats']['top_teams'] %}
  <table>
    <thead>
      <tr>
        <th>Rang</th>
        <th>√âquipe</th>
        <th>Victoires</th>
      </tr>
    </thead>
    <tbody>
      {% for team in REQUEST_VARS['stats']['top_teams'] %}
      <tr>
        <td>#{{ loop.index }}</td>
        <td><strong>{{ team.name }}</strong></td>
        <td>{{ team.wins }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="empty-message">
    Aucun match termin√© n'a encore √©t√© enregistr√©.
  </p>
  {% endif %}
</section>

<section class="durations">
  <h3>‚è±Ô∏è Dur√©es des parties cl√¥tur√©es</h3>
  <ul>
    <li>
      <strong>Partie la plus rapide :</strong>
      {% if REQUEST_VARS['stats']['fastest_game'] %}
        <span class="team-name">{{ REQUEST_VARS['stats']['fastest_game']['team1_name'] }}</span>
        <span class="team-color-badge" style="background-color: {{ REQUEST_VARS['stats']['fastest_game']['team1_color'] }};"></span>
        <span class="vs-separator">vs</span>
        <span class="team-name">{{ REQUEST_VARS['stats']['fastest_game']['team2_name'] }}</span>
        <span class="team-color-badge" style="background-color: {{ REQUEST_VARS['stats']['fastest_game']['team2_color'] }};"></span>
        {% if REQUEST_VARS['stats']['fastest_game']['winner_name'] %}
          <span class="arrow-separator">‚Üí</span>
          <span class="winner-name">{{ REQUEST_VARS['stats']['fastest_game']['winner_name'] }}</span>
          <span class="winner-color-badge" style="background-color: {{ REQUEST_VARS['stats']['fastest_game']['winner_color'] }};"></span>
        {% else %}
          <span class="arrow-separator">‚Üí</span>
          <span class="equality-text">√âgalit√©</span>
        {% endif %}
        ‚Äî <span class="duration-value">{{ REQUEST_VARS['stats']['fastest_game']['duration'] }}</span>
      {% else %}
        <span class="waiting-data">en attente de donn√©es.</span>
      {% endif %}
    </li>
    <li>
      <strong>Partie la plus longue :</strong>
      {% if REQUEST_VARS['stats']['longest_game'] %}
        <span class="team-name">{{ REQUEST_VARS['stats']['longest_game']['team1_name'] }}</span>
        <span class="team-color-badge" style="background-color: {{ REQUEST_VARS['stats']['longest_game']['team1_color'] }};"></span>
        <span class="vs-separator">vs</span>
        <span class="team-name">{{ REQUEST_VARS['stats']['longest_game']['team2_name'] }}</span>
        <span class="team-color-badge" style="background-color: {{ REQUEST_VARS['stats']['longest_game']['team2_color'] }};"></span>
        {% if REQUEST_VARS['stats']['longest_game']['winner_name'] %}
          <span class="arrow-separator">‚Üí</span>
          <span class="winner-name">{{ REQUEST_VARS['stats']['longest_game']['winner_name'] }}</span>
          <span class="winner-color-badge" style="background-color: {{ REQUEST_VARS['stats']['longest_game']['winner_color'] }};"></span>
        {% else %}
          <span class="arrow-separator">‚Üí</span>
          <span class="equality-text">√âgalit√©</span>
        {% endif %}
        ‚Äî <span class="duration-value">{{ REQUEST_VARS['stats']['longest_game']['duration'] }}</span>
      {% else %}
        <span class="waiting-data">en attente de donn√©es.</span>
      {% endif %}
    </li>
  </ul>
</section>

<section class="logs">
  <h3>üìù Moyenne de lignes de journalisation par mois</h3>
  {% if REQUEST_VARS['stats']['avg_logs'] %}
  <table>
    <thead>
      <tr>
        <th>Ann√©e</th>
        <th>Mois</th>
        <th>Moyenne</th>
      </tr>
    </thead>
    <tbody>
      {% for row in REQUEST_VARS['stats']['avg_logs'] %}
      <tr>
        <td>{{ row.year }}</td>
        <td>{{ "%02d"|format(row.month) }}</td>
        <td><strong>{{ "%.2f"|format(row.avg_logs) }}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="empty-message">
    Les journaux n'ont pas encore √©t√© g√©n√©r√©s.
  </p>
  {% endif %}
</section>

{% include 'message.html' %}
{% endblock %}
